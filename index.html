<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Dylan Fisher">
    <meta name="description" content="Repo Index">

    <title>Document</title>
</head>
<body>
    <h1>Welcome to Dylan's Repo Index</h1>
    <h2>A place fo all of my project links</h2>
    
</body>
<script type="module">
/*
import { Octokit } from "octokit";

const octokit = new Octokit({ 
    auth: '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',
});*/

function getData(username, repo, path){
    const urlString = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
    const request = new XMLHttpRequest();
    request.open("GET", urlString, false);
    request.send(null);

    if (request.status === 200) {
        return JSON.parse(request.responseText);
    }

    return null;
}

function seperateDirectories(data){
    const types = data.map(item => item.type);
    const length = types.length
    var directories = []
    var files = []
    for(var i = 0; i < length; i++){
        if(types[i] == 'dir'){
            directories.push(data[i])
        } else {
            files.push(data[i])
        }
    }
    return {"dir": directories, "files": files};
}

function itterativeSearch(username, repo, startPath, files = []){
    var dir = []
    var seperated = seperateDirectories(getData(username, repo, startPath))
    files.push(seperated['files'])
    dir = seperated['dir']
    for(dictionarys in dir){
        var currentDictionary = dir[dictionarys]
        var path = currentDictionary['path']
        files = itterativeSearch(username, repo, path, files)
    }
    files = [].concat.apply([], files);
    return files
}

function getFilesByName(username, repo, name){
    originalSearch = itterativeSearch(username, repo, "")
    filesByName = []
    for(dict in originalSearch){
        if(originalSearch[dict]["name"] == name){
            filesByName.push(originalSearch[dict])
        }
    }
    return filesByName
}

function currentPath(){
    var loc = window.location.pathname;
    var dir = loc.substring(0, loc.lastIndexOf('/'));
    return dir
}

function createHeading(text){
    var h = document.createElement('H3')
    var t = document.createTextNode(text);
    h.appendChild(t)
    document.body.appendChild(h);
}

function fillLinks(username, repo){
    var data = getData(username, repo, "")
    for(const dict in data) {
        var name = data[dict]['name']
        if(name != 'README.md' && data[dict]['path'] != 'index.html'){
            createHeading(name)

            var a = document.createElement('a') 
            var link = document.createTextNode(name)
            a.appendChild(link)

            a.title = "This is link to" + name

            a.href = currentPath() + "/" + data[dict]['path']

            document.body.appendChild(a);
        }
    }
}

fillLinks("Salvanim", "SE111_202420")

</script>
</html>